name: Trigger Webhook for publishing package to pub.dev on Tag Creation

on:
  push:
    tags:
      - '*'

jobs:
  trigger-webhook:
    runs-on: ubuntu-latest    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Debug environment variables and context
        shell: bash
        env:
          WEBHOOK_URL: "${{ secrets.SD_PUB_DEV_PUBLISHING_URL }}"
          WEBHOOK_URL_TEST: ${{ secrets.SD_PUB_DEV_PUBLISHING_URL }}
          AUTH_TOKEN: "${{ secrets.SD_PUB_DEV_PUBLISHING_AUTH_TOKEN }}"
        run: |
          echo "WEBHOOK_URL: $WEBHOOK_URL"
          echo "WEBHOOK_URL_TEST: $WEBHOOK_URL"
          echo "URL length: ${#WEBHOOK_URL}"
          echo "URL length: ${#WEBHOOK_URL_TEST}"
          echo "URL starts with: ${WEBHOOK_URL:0:16}..."
          # echo "URL starts with: ${WEBHOOK_URL_TEST:0:166}..."
          if [ -n "$WEBHOOK_URL" ]; then echo "URL_Test: WEBHOOK_URL is set"; else echo "URL_Test: WEBHOOK_URL is not set"; fi

      - uses: sozo-design/curl@v1.0.2
      - name: Send cURL request
        env:
          WEBHOOK_URL: ${{ secrets.SD_PUB_DEV_PUBLISHING_URL }}
          AUTH_TOKEN: ${{ secrets.SD_PUB_DEV_PUBLISHING_AUTH_TOKEN }}
        run: |          
          curl --manual --location --request POST 
          curl -X POST "$WEBHOOK_URL" \      
          -H "Authorization: $AUTH_TOKEN"